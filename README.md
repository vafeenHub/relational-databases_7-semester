# Реляционные системы управления базами данных 7 семестр

## Установка окружения

### Подготовка

* Установите [Docker](https://learn.microsoft.com/ru-ru/virtualization/windowscontainers/quick-start/set-up-environment?tabs=Windows-Server);
* Установите [Visual Studio Code](https://code.visualstudio.com/download);
* Загрузите расширение [Oracle SQL Developer Extension for VSCode](https://marketplace.visualstudio.com/items?itemName=Oracle.sql-developer);

### Инструкция

Вы можете воссоздать контейнер из предсобранного образа или собрать его вручную.

#### Запуск предсобранной версии

Для запуска контейнера откройте консоль и выполните: `docker run --name oracledb -p 1521:1521 -p 5500:5500 -p 8080:8080 --cpus=0.5 -m 2g -td ghcr.io/niapollab/rsubd`.

#### Ручная сборка

1. Клонируйте репозиторий;
2. Откройте консоль в директории [Environment](/Environment);
3. В консоли выполните:

    ```sh
    build
    ```

4. Дождитесь завершения построения контейнера.

#### Настройка соединения в VSCode

![Новое соединение](/Environment/.resources/oracle_developer_tools_create_connection.png)
> [!TIP]
> Пароль: Passw0rd

> [!CAUTION]
> Не открывайте соединение более чем в одном файле одновременно. Если вы уже открыли соединение в этом файле для выполнения запросов, сначала закройте его перед тем, как использовать другой файл. Иначе соединение останется активным, из-за чего последующие запросы из других файлов будут либо блокироваться, либо завершаться с ошибкой.

> [!WARNING]
> Docker может слишком долго подключаться к Oracle, изз-за чего VSCode будет выдавать ошибку подключения. Контейнер Oracle, когда полностью готов к использованию, пишет в логах следующее сообщение
>
>```
>#########################
>DATABASE IS READY TO USE!
>#########################
>```

> [!NOTE]
> [Dockerfile](/Environment/bin/Dockerfile) базируется на [данном репозитории](https://github.com/oracle/docker-images/tree/main/OracleDatabase/SingleInstance/dockerfiles/21.3.0).

## Task

### Описание бд

База данных автосервиса «Автокомплект». Спроектировать БД автосервиса «Автокомплект». Автосервис выполняет заказы на ремонт автомобилей. В БД необходимо фиксировать данные об автомобиле: номер, год выпуска, марку, модель, категорию, тип кузова, фамилию, имя, отчество и телефон владельца. У одного владельца может быть несколько автомобилей. Информация о заказе включает в себя дату поступления заказа, запланированный и фактический сроки выполнения заказа, список неисправностей автомобиля, наименования работ, список запчастей, подлежащих замене, общую стоимость заказа, комментарии. За исполнение заказа отвечает мастер. Данные о мастере: фамилия, имя, отчество, телефон, дата рождения, специализация, стаж и доля ставки, на которую работает мастер. В автосервисе имеются запчасти, необходимые для ремонта. Информация о запчастях состоит из наименования, кода, категории, дополнительных характеристик, количества в наличии, единиц измерения (название и сокращение). Время от времени автосервис заказывает запчасти у поставщиков. Заказ запчастей описывается датой формирования заказа, планируемой и фактической датами поступления запчастей, перечнем запчастей, их количеством и стоимостью в заказе. Информация о поставщике включает наименование, адрес, телефон(-ы), фамилию, имя, отчество менеджера.

### Запросы для бд

28. Выбрать госномер автомобиля, дату последнего обращения и, если были замены запчастей, то их количество.  
29. Выбрать госномер автомобиля, дату последнего обращения и, если были замены запчастей, то наименования запчастей.
30. Выбрать название марки и название моделей, автомобили которых не представлены в БД.
31. Выбрать номер автомобиля, которому каждый раз делают замену одной и той же запчасти.
32. Для  каждого  поставщика  вывести  названия  категорий запчастей, которые он не поставляет.
33. Выбрать  фамилии,  имена,  отчества  мастеров  и  размер ставки.  Результат  отсортировать  следующим  образом:  в  первую очередь тех, кто не выполнил ни одного заказа за текущий месяц, затем тех, кто выполнил максимальное количество заказов за текущий месяц, в последнюю очередь все остальные.
34. Для каждого поставщика выбрать названия всех категорий запчастей и количество различных запчастей, им поставляемых. Если поставщик не поставляет запчасти какой-то категории, вывести 0. Результат отсортировать по id_поставщика и по названию категории.
35. Выбрать  фамилию,  имя,  отчество  владельца  двух  автомобилей одной модели.
36. Выбрать госномера, названия модели и марки автомобилей одной модели и одного года выпуска, которые ремонтировались одинаковое количество раз.  
37. Выбрать название марки и модели, автомобили которой ремонтировались чаще других.
38. Выбрать  все  данные  об  автомобилях,  для  которых  не производились замены запчастей.
39. Выбрать все данные о заказе с самым продолжительным сроком исполнения.
40. Выбрать  фамилию,  имя,  отчество  владельца,  госномер автомобиля, на который был сделан самый дорогой заказ.
41. Выбрать  название  марки,  название  модели  и  название запчасти,  которую  приходится  менять  для  данной  модели  чаще других.
42. Для последнего года выбрать количество просроченных заказов, количество заказов, выполненных вовремя, и количество 70 заказов, выполненных раньше срока по строкам. Пример результата:
  Просроченные заказы  10
  Заказы в срок      90
  Заказы раньше срока   20
43. Для каждого месяца выбрать количество просроченных заказов, количество заказов, выполненных вовремя, и количество заказов, выполненных раньше срока по строкам. В результирующей таблице должно быть три столбца: название месяца, название вида количества (просроченные заказы, заказы в срок, заказы, выполненные раньше срока) и количество. Результат отсортировать по месяцам.
44. Выбрать  автомобиль,  на  котором  ни  одну  запчасть  не меняли дважды.
45. Выбрать  фамилию,  имя, отчество  мастера,  который  чинил автомобили всех категорий
46. Выбрать  фамилии,  имена,  отчества  владельцев  транспортных средств двух разных категорий, которые имеют два автомобиля одной марки.
47. Выбрать  названия  запчастей,  которые  устанавливались на самые старые автомобили.
48. Выбрать марку, модель, госномер автомобилей, на которых делали замену, как самой дорогой, так и самой дешевой запчасти.
49. Вывести фамилии, имена, отчества владельцев, которые обладают 2 автомобилями и более, но не имеют тезок и/или одно-фамильцев.
50. Выбрать тройку самых старых автомобилей.
51. Выбрать  все  даты  прошлого  месяца,  в  которые  не осуществляли замену запчастей.
52. Выбрать  названия  поставщиков,  количество  заказов  в прошлом году, процентное отношение ко всем заказам прошлого года.
